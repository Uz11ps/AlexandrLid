# Требования заказчика (Artak)

## 1. Функционал создания в веб-интерфейсе

### Проблема:
- Сейчас в вебке только отображаются данные по боту
- Нет функционала создания рассылок и розыгрышей через веб-интерфейс

### Решение:
- ✅ Добавить форму создания/редактирования рассылок в разделе "Админка бота" → "Рассылки"
- ✅ Добавить форму создания/редактирования розыгрышей в разделе "Админка бота" → "Розыгрыши"
- ✅ Добавить формы для автоворонок и лид-магнитов

## 2. Система переписки/чата

### Требования:
- Отдельная вкладка "Чат" или "Переписка" в CRM
- Переписка между пользователем (Telegram) и администратором/менеджером (CRM)
- Роли:
  - **Админ**: может просматривать все переписки и отвечать при необходимости
  - **Менеджер**: ведет основную переписку с пользователями
- Админ/менеджер может начать диалог с пользователем сам
- Тикеты для техподдержки (пользователь может создать тикет через бота)

### Логика:
- В большинстве случаев диалог начинают менеджеры/админы
- Тикеты используются для вопросов пользователей в техподдержку

## 3. Система прав доступа

### Требования:
- Страница для админа: "Управление правами доступа"
- Управление правами:
  - По ролям (admin, manager, marketer, accountant)
  - По отдельным пользователям (менеджерам)
- Права для каждого раздела:
  - **Просмотр** (read)
  - **Редактирование** (edit)
  - **Создание** (create)
  - **Удаление** (delete)

### Разделы для управления правами:
- Лиды
- Студенты
- Сделки
- Продукты
- Задачи
- Аналитика
- Шаблоны
- Документы
- Админка бота (рассылки, розыгрыши, автоворонки, лид-магниты)
- Чат/Переписка

## 4. Роли пользователей

### Существующие роли:
- `admin` - полный доступ
- `manager` - менеджер (основная работа с лидами и перепиской)
- `marketer` - маркетолог
- `accountant` - бухгалтер

### Новые требования:
- Менеджер должен иметь возможность вести переписку с пользователями
- Админ может просматривать и вмешиваться при необходимости
- Разные права доступа к разделам в зависимости от роли

## План реализации

### Этап 1: Функционал создания в вебке
1. Добавить формы создания рассылок
2. Добавить формы создания розыгрышей
3. Добавить формы создания/редактирования автоворонок
4. Добавить формы создания/редактирования лид-магнитов

### Этап 2: Система чата/переписки
1. Создать таблицу `tickets` в БД
2. Создать таблицу `ticket_messages` в БД
3. Добавить API endpoints для чата
4. Добавить страницу "Чат" в CRM
5. Интеграция с Telegram ботом для отправки/получения сообщений
6. Добавить возможность создания тикета через бота

### Этап 3: Система прав доступа
1. Создать таблицу `permissions` в БД
2. Создать таблицу `role_permissions` в БД
3. Создать таблицу `user_permissions` в БД
4. Добавить страницу "Управление правами" в CRM
5. Реализовать middleware для проверки прав
6. Обновить все API endpoints для проверки прав

### Этап 4: Обновление ролей
1. Обновить систему ролей
2. Настроить права по умолчанию для каждой роли
3. Добавить возможность кастомизации прав для конкретных пользователей

