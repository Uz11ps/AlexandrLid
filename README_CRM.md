# CRM System - Phase 1.0

## Обзор

CRM система интегрирована с существующим Telegram ботом. Система состоит из трех основных компонентов:

1. **Telegram Bot** (существующий) - обрабатывает взаимодействия пользователей
2. **CRM Backend** (Express.js) - REST API для управления лидами и задачами
3. **CRM Frontend** (React.js) - веб-интерфейс для менеджеров

## Быстрый старт

### 1. Создание первого администратора

После первого запуска базы данных, создайте администратора:

```bash
docker-compose exec crm-backend node scripts/create-admin.js admin@example.com admin123 "Admin Name"
```

### 2. Запуск всех сервисов

```bash
docker-compose up -d
```

Сервисы будут доступны:
- **CRM Frontend**: http://localhost:3000
- **CRM Backend API**: http://localhost:3001
- **Telegram Bot**: Работает в фоне

### 3. Вход в систему

Откройте http://localhost:3000 и войдите с учетными данными администратора, созданными на шаге 1.

## Структура проекта

```
.
├── src/                    # Telegram Bot (существующий)
├── crm-backend/           # Express.js API
│   ├── routes/            # API маршруты
│   ├── scripts/           # Утилиты (создание админа)
│   └── server.js          # Точка входа
├── crm-frontend/          # React приложение
│   └── src/
│       ├── pages/         # Страницы
│       ├── api/           # API клиенты
│       └── contexts/      # React контексты
└── docker-compose.yml     # Конфигурация Docker
```

## Функциональность Phase 1.0

### Управление лидами
- ✅ Автоматическое создание лидов из Telegram бота
- ✅ Просмотр списка лидов с фильтрацией
- ✅ Детальная карточка лида
- ✅ Редактирование информации о лиде
- ✅ Изменение этапа воронки продаж
- ✅ Комментарии к лидам
- ✅ Отправка сообщений в Telegram из CRM

### Задачи и напоминания
- ✅ Создание задач/напоминаний для лидов
- ✅ Просмотр задач на сегодня/завтра/предстоящие
- ✅ Фильтрация задач по статусу и приоритету

### Интеграция с ботом
- ✅ Синхронизация пользователей бота с таблицей лидов
- ✅ Отправка сообщений пользователям через бота из CRM

## API Endpoints

### Authentication
- `POST /api/auth/login` - Вход

### Leads
- `GET /api/leads` - Список лидов
- `GET /api/leads/:id` - Детали лида
- `POST /api/leads` - Создать лида
- `PUT /api/leads/:id` - Обновить лида
- `POST /api/leads/:id/comments` - Добавить комментарий
- `POST /api/leads/:id/message` - Отправить сообщение

### Tasks
- `GET /api/tasks` - Список задач
- `POST /api/tasks` - Создать задачу
- `PUT /api/tasks/:id` - Обновить задачу
- `DELETE /api/tasks/:id` - Удалить задачу

## База данных

Все таблицы создаются автоматически при первом запуске PostgreSQL контейнера через `init.sql`.

### Основные таблицы CRM:
- `managers` - Пользователи CRM системы
- `leads` - Лиды (расширенная информация о пользователях)
- `lead_comments` - Комментарии к лидам
- `tasks` - Задачи и напоминания
- `lead_interactions` - История взаимодействий

## Переменные окружения

Убедитесь, что в `.env` файле указаны:
- `BOT_TOKEN` - Токен Telegram бота
- `JWT_SECRET` - Секретный ключ для JWT (измените в production!)

## Следующие фазы

- Модуль управления студентами
- Модуль продуктов и тарифов
- Модуль аналитики и отчетности
- Модуль прав доступа и пользователей
- Модуль документов

